<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" />
<title>Car Racing Game - Single & Two Player</title>
<style>
  body, html {
    margin: 0; padding: 0; height: 100%;
    font-family: Arial, sans-serif;
    background: #111;
    color: white;
    overflow: hidden;
  }

  #menuScreen, #gameOverScreen, #countdownScreen {
    position: fixed;
    top:0; left:0; right:0; bottom:0;
    background: rgba(0,0,0,0.9);
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    z-index: 999;
  }

  #menuScreen button, #gameOverScreen button {
    margin: 10px;
    padding: 15px 40px;
    font-size: 24px;
    cursor: pointer;
    border: none;
    border-radius: 10px;
    background: #f39c12;
    color: #222;
    transition: background 0.3s;
  }
  #menuScreen button:hover, #gameOverScreen button:hover {
    background: #e67e22;
  }

  #gameArea {
    position: relative;
    width: 100vw;
    max-width: 400px;
    height: 600px;
    max-height: 90vh;
    margin: auto;
    top: 50%;
    transform: translateY(-50%);
    background: linear-gradient(to right,
      #228B22 0%,       
      #228B22 35%, 
      #333 35%,         
      #333 65%, 
      #228B22 65%,      
      #228B22 100%);
    overflow: hidden;
    box-shadow: 0 0 15px #000;
    border-radius: 15px;
  }

  #road {
    position: absolute;
    top: 0; left: 50%;
    width: 300px;
    height: 100%;
    transform: translateX(-50%);
    background: repeating-linear-gradient(
      to bottom,
      #444 0px,
      #444 30px,
      #555 30px,
      #555 60px
    );
    animation: scrollRoad 2s linear infinite;
    box-shadow: 0 0 10px 3px #555 inset;
    border-left: 15px solid #ccc;
    border-right: 15px solid #ccc;
    border-radius: 10px;
  }

  #road::before {
    content: "";
    position: absolute;
    top: 0; left: 50%;
    width: 10px;
    height: 100%;
    background: repeating-linear-gradient(
      to bottom,
      yellow 0px,
      yellow 15px,
      transparent 15px,
      transparent 30px
    );
    transform: translateX(-50%);
    animation: stripesMove 1s linear infinite;
  }

  @keyframes stripesMove {
    0% { background-position-y: 0; }
    100% { background-position-y: 30px; }
  }

  @keyframes scrollRoad {
    0% { background-position-y: 0; }
    100% { background-position-y: 60px; }
  }

  .car {
    position: absolute;
    bottom: 50px;
    width: 60px;
    height: 100px;
    border-radius: 10px;
    box-shadow: 0 0 10px #000;
    z-index: 10;
  }
  #car1 {
    background: red;
  }
  #car2 {
    background: blue;
    display: none;
  }

  .enemyCar {
    position: absolute;
    width: 60px;
    height: 100px;
    background: purple;
    border-radius: 10px;
    box-shadow: 0 0 8px #000;
    z-index: 9;
  }

  #score1, #score2 {
    position: fixed;
    top: 10px;
    background: rgba(255,255,255,0.9);
    padding: 6px 12px;
    border-radius: 5px;
    font-weight: bold;
    font-size: 18px;
    color: black;
    z-index: 101;
  }

  #score1 { left: 10px; }
  #score2 { right: 10px; }

  #gameOverScreen {
    display: none;
    color: white;
    font-size: 48px;
  }

  #countdownScreen {
    display: none;
    color: white;
    font-size: 60px;
    justify-content: center;
    align-items: center;
    position: fixed;
    top:0; left:0; right:0; bottom:0;
    background: rgba(0,0,0,0.8);
    z-index: 1000;
  }

  #countdownText {
    font-size: 60px;
    margin-bottom: 20px;
  }

  /* Mobile touch areas */
  #touchLeft, #touchRight {
    position: fixed;
    bottom: 100px;
    width: 50%;
    height: 150px;
    z-index: 10000;
    opacity: 0.1;
    user-select: none;
  }
  #touchLeft {
    left: 0;
    background: red;
  }
  #touchRight {
    right: 0;
    background: blue;
  }

</style>
</head>
<body>

<div id="menuScreen">
  <h1>Choose Game Mode</h1>
  <button id="singleBtn">Single Player</button>
  <button id="doubleBtn">Two Players</button>
</div>

<div id="countdownScreen">
  <div id="countdownText">3</div>
</div>

<div id="gameArea" style="display:none;">
  <div id="road"></div>
  <div id="car1" class="car"></div>
  <div id="car2" class="car"></div>

  <div id="score1" style="display:none;">Score 1: 0</div>
  <div id="score2" style="display:none;">Score 2: 0</div>
</div>

<div id="gameOverScreen">
  <div id="gameOverMessage">Game Over! You crashed.</div>
  <button id="restartButton">Restart</button>
</div>

<!-- Mobile touch controls -->
<div id="touchLeft"></div>
<div id="touchRight"></div>

<script>
  const menuScreen = document.getElementById('menuScreen');
  const countdownScreen = document.getElementById('countdownScreen');
  const countdownText = document.getElementById('countdownText');
  const gameArea = document.getElementById('gameArea');
  const car1 = document.getElementById('car1');
  const car2 = document.getElementById('car2');
  const score1Display = document.getElementById('score1');
  const score2Display = document.getElementById('score2');
  const gameOverScreen = document.getElementById('gameOverScreen');
  const gameOverMessage = document.getElementById('gameOverMessage');
  const restartButton = document.getElementById('restartButton');
  const touchLeft = document.getElementById('touchLeft');
  const touchRight = document.getElementById('touchRight');

  let enemyCars = [];
  let gameOver = false;
  let gameStarted = false;
  let mode = 'single'; // default mode
  let score1 = 0;
  let score2 = 0;
  let enemyInterval;
  let scoreInterval;

  let keys = {};

  document.getElementById('singleBtn').addEventListener('click', () => startGameMode('single'));
  document.getElementById('doubleBtn').addEventListener('click', () => startGameMode('double'));
  restartButton.addEventListener('click', () => location.reload());

  function startGameMode(selectedMode) {
    mode = selectedMode;
    menuScreen.style.display = 'none';
    gameArea.style.display = 'block';

    if (mode === 'single') {
      car2.style.display = 'none';
      score2Display.style.display = 'none';
      score1Display.style.display = 'block';
      resetPositions();
    } else {
      car2.style.display = 'block';
      score2Display.style.display = 'block';
      score1Display.style.display = 'block';
      resetPositions();
    }

    startCountdown();
  }

  function resetPositions() {
    const gameAreaRect = gameArea.getBoundingClientRect();
    const roadLeft = gameAreaRect.left + (gameAreaRect.width / 2) - 150; // 300px road width

    car1.style.left = (roadLeft + 120) + 'px';
    car1.style.bottom = '50px';

    if (mode === 'double') {
      car2.style.left = (roadLeft + 200) + 'px';
      car2.style.bottom = '50px';
    }
  }

  function startCountdown() {
    countdownScreen.style.display = 'flex';
    let count = 3;
    countdownText.textContent = count;

    const countdownInterval = setInterval(() => {
      count--;
      if (count > 0) {
        countdownText.textContent = count;
      } else {
        clearInterval(countdownInterval);
        countdownText.textContent = 'Go!';
        setTimeout(() => {
          countdownScreen.style.display = 'none';
          startGame();
        }, 700);
      }
    }, 1000);
  }

  function startGame() {
    gameStarted = true;
    gameOver = false;
    score1 = 0;
    score2 = 0;
    score1Display.textContent = 'Score 1: 0';
    score2Display.textContent = 'Score 2: 0';

    enemyInterval = setInterval(createEnemyCar, 1500);
    scoreInterval = setInterval(updateScore, 500);

    window.requestAnimationFrame(gameLoop);
  }

  document.addEventListener('keydown', e => {
    keys[e.key.toLowerCase()] = true;
  });
  document.addEventListener('keyup', e => {
    keys[e.key.toLowerCase()] = false;
  });

  // Touch controls for mobile
  touchLeft.addEventListener('touchstart', e => {
    e.preventDefault();
    keys['a'] = true;
  });
  touchLeft.addEventListener('touchend', e => {
    e.preventDefault();
    keys['a'] = false;
  });
  touchRight.addEventListener('touchstart', e => {
    e.preventDefault();
    keys['d'] = true;
  });
  touchRight.addEventListener('touchend', e => {
    e.preventDefault();
    keys['d'] = false;
  });

  if (mode === 'double') {
    // Player 2 keys (arrow left/right)
    document.addEventListener('keydown', e => {
      if (e.key === 'ArrowLeft') keys['arrowleft'] = true;
      if (e.key === 'ArrowRight') keys['arrowright'] = true;
    });
    document.addEventListener('keyup', e => {
      if (e.key === 'ArrowLeft') keys['arrowleft'] = false;
      if (e.key === 'ArrowRight') keys['arrowright'] = false;
    });
  }

  function createEnemyCar() {
    if (gameOver) return;

    const enemy = document.createElement('div');
    enemy.classList.add('enemyCar');
    // random lane on road (between road left+10 to road left+230, lane width roughly 60px)
    const gameAreaRect = gameArea.getBoundingClientRect();
    const roadLeft = (gameAreaRect.width / 2) - 150;

    const lanes = [roadLeft + 20, roadLeft + 90, roadLeft + 160, roadLeft + 230];
    const lane = lanes[Math.floor(Math.random() * lanes.length)];

    enemy.style.left = lane + 'px';
    enemy.style.bottom = gameArea.clientHeight + 'px'; // start just above view
    gameArea.appendChild(enemy);

    enemyCars.push(enemy);
  }

  function updateScore() {
    if (gameOver) return;

    score1++;
    score1Display.textContent = 'Score 1: ' + score1;

    if (mode === 'double') {
      score2++;
      score2Display.textContent = 'Score 2: ' + score2;
    }
  }

  function gameLoop() {
    if (gameOver || !gameStarted) return;

    movePlayerCars();
    moveEnemyCars();
    checkCollisions();

    window.requestAnimationFrame(gameLoop);
  }

  function movePlayerCars() {
    const gameAreaRect = gameArea.getBoundingClientRect();
    const roadLeft = (gameAreaRect.width / 2) - 150;

    // Move player 1 (A/D)
    let left1 = parseInt(car1.style.left);
    if (keys['a'] && left1 > roadLeft + 10) {
      car1.style.left = (left1 - 7) + 'px';
    }
    if (keys['d'] && left1 < roadLeft + 230) {
      car1.style.left = (left1 + 7) + 'px';
    }

    // Move player 2 (ArrowLeft/ArrowRight)
    if (mode === 'double') {
      let left2 = parseInt(car2.style.left);
      if (keys['arrowleft'] && left2 > roadLeft + 10) {
        car2.style.left = (left2 - 7) + 'px';
      }
      if (keys['arrowright'] && left2 < roadLeft + 230) {
        car2.style.left = (left2 + 7) + 'px';
      }
    }
  }

  function moveEnemyCars() {
    const speed = 5;

    enemyCars.forEach((enemy, index) => {
      let bottom = parseInt(enemy.style.bottom);
      bottom -= speed;
      enemy.style.bottom = bottom + 'px';

      if (bottom < -120) {
        enemy.remove();
        enemyCars.splice(index, 1);
      }
    });
  }

  function checkCollisions() {
    const cars = [car1];
    if (mode === 'double') cars.push(car2);

    enemyCars.forEach(enemy => {
      const enemyRect = enemy.getBoundingClientRect();

      for (const car of cars) {
        const carRect = car.getBoundingClientRect();

        if (!(
          carRect.right < enemyRect.left ||
          carRect.left > enemyRect.right ||
          carRect.bottom < enemyRect.top ||
          carRect.top > enemyRect.bottom
        )) {
          endGame();
        }
      }
    });
  }

  function endGame() {
    gameOver = true;
    gameStarted = false;
    clearInterval(enemyInterval);
    clearInterval(scoreInterval);
    gameOverScreen.style.display = 'flex';
    gameArea.style.display = 'none';

    gameOverMessage.textContent = `Game Over! Your Score: Player 1 = ${score1}` + (mode === 'double' ? ` | Player 2 = ${score2}` : '');
  }

  // Initial position setup on load or resize
  window.addEventListener('resize', () => {
    if (gameStarted) resetPositions();
  });

</script>

</body>
</html>
